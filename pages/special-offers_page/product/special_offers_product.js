// Define Products Data
const productsData = [
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
    {
        href: "./x_offer_1_page.html",
        imgSrc: "./assets/properties/malibu_beachhouse/cover.jpg",
        title: "Luxury Beach House in Malibu with Stunning Ocean Views",
        price: "10 500 000€",
        city: "Malibu, California"
    },
];

// Product Component Definition
class ProductComponent extends HTMLElement {
    connectedCallback() {
        this.render();
    }

    render() {
        const href = this.getAttribute('data-href');
        const imgSrc = this.getAttribute('data-img-src');
        const title = this.getAttribute('data-title');
        const price = this.getAttribute('data-price');
        const city = this.getAttribute('data-city');

        this.innerHTML = `
            <link rel="stylesheet" href="./pages/special-offers_page/product/special_offers_product.css">
            <div id="top-offer-grid-item">
                <a href="${href}">
                    <img src="${imgSrc}" alt="">
                    <span id="img-cont-title">${title}</span>
                    <span id="img-cont-price">${price}</span>
                    <span id="img-cont-city">${city}</span>
                </a>
            </div>
        `;
    }
}

// Custom Element Registration
customElements.define('special-offer-product', ProductComponent);

// DOMContentLoaded Event Listener
document.addEventListener("DOMContentLoaded", () => {
    const productsContainer = document.querySelector('.image-grid-section2');
    const showNextBtn = document.getElementById('show-next-btn');
    const productsPerClick = 6; // Number of products to add/remove per click
    let initialProductsToShow = 6; // Default number of products to show
    const animationDelay = 100; // Delay between each product animation in milliseconds
    let currentIndex;

    // Determine the number of products to show based on the page
    if (window.location.pathname.includes('special_offers_page.html')) {
        initialProductsToShow = 12;
    }
    currentIndex = initialProductsToShow;

    // Function to smoothly change opacity over time
    function animateOpacity(element, targetOpacity, duration, delay) {
        const startOpacity = parseFloat(element.style.opacity) || 0;
        const startTime = performance.now();

        function updateOpacity() {
            const elapsed = performance.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const opacity = startOpacity + progress * (targetOpacity - startOpacity);
            element.style.opacity = opacity.toFixed(2);

            if (progress < 1) {
                requestAnimationFrame(updateOpacity);
            }
        }

        // Apply delay before starting animation
        setTimeout(() => {
            updateOpacity();
        }, delay);
    }

    // Function to show next batch of products
    function showNextProducts() {
        // Calculate the remaining products to show
        const remainingProducts = productsData.slice(currentIndex, currentIndex + productsPerClick);

        // Render each remaining product with opacity animation and delay
        remainingProducts.forEach((productData, index) => {
            const productElement = document.createElement('special-offer-product');
            productElement.setAttribute('data-href', productData.href);
            productElement.setAttribute('data-img-src', productData.imgSrc);
            productElement.setAttribute('data-title', productData.title);
            productElement.setAttribute('data-price', productData.price);
            productElement.setAttribute('data-city', productData.city);
            productElement.style.opacity = '0'; // Start opacity for animation
            productsContainer.appendChild(productElement);

            // Calculate delay for each product animation
            const delay = index * animationDelay;

            // Animate opacity change with delay
            animateOpacity(productElement, 1, 500, delay); // 500ms duration, adjust as needed
        });

        currentIndex += productsPerClick;

        // Update button text and behavior when reaching the end of products
        if (currentIndex >= productsData.length) {
            showNextBtn.value = 'Show Less';
            showNextBtn.removeEventListener('click', showNextProducts);
            showNextBtn.addEventListener('click', showLessProducts);
        }
    }

    // Function to show less products
    function showLessProducts() {
        // Calculate the index of products to remove
        const endRemoveIndex = Math.max(currentIndex - productsPerClick, initialProductsToShow);

        // Remove products from DOM with opacity animation
        for (let i = currentIndex - 1; i >= endRemoveIndex; i--) {
            const productToRemove = productsContainer.children[i];
            animateOpacity(productToRemove, 0, 500, 0); // 500ms duration, no delay for removal

            // Remove the product element after animation completes
            setTimeout(() => {
                productsContainer.removeChild(productToRemove);
            }, 500); // Should match the duration of the animation
        }

        currentIndex = endRemoveIndex;

        // Update button text and behavior when returning to initial state
        if (currentIndex <= initialProductsToShow) {
            showNextBtn.value = 'Show More';
            showNextBtn.removeEventListener('click', showLessProducts);
            showNextBtn.addEventListener('click', showNextProducts);
        }
    }

    // Initial setup for Show More button
    if (showNextBtn) {
        showNextBtn.addEventListener('click', showNextProducts);
    }

    // Initially render the first set of products
    productsData.slice(0, initialProductsToShow).forEach((productData, index) => {
        const productElement = document.createElement('special-offer-product');
        productElement.setAttribute('data-href', productData.href);
        productElement.setAttribute('data-img-src', productData.imgSrc);
        productElement.setAttribute('data-title', productData.title);
        productElement.setAttribute('data-price', productData.price);
        productElement.setAttribute('data-city', productData.city);
        productElement.style.opacity = '0'; // Start opacity for animation

        // Calculate delay for each initial product animation
        const delay = index * animationDelay;
        animateOpacity(productElement, 1, 500, delay); // 500ms duration, adjust as needed

        productsContainer.appendChild(productElement);
    });
});
